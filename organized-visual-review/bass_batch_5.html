<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review: BASS - Batch 5</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .header { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .navigation { margin-bottom: 20px; }
        .nav-button { display: inline-block; padding: 10px 15px; background: #007bff; color: white; text-decoration: none; border-radius: 4px; margin-right: 10px; }
        .nav-button:hover { background: #0056b3; }
        .image-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .image-card { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .image-container { position: relative; height: 250px; overflow: hidden; }
        .image-container img { width: 100%; height: 100%; object-fit: cover; cursor: pointer; }
        .image-info { padding: 15px; }
        .filename { font-weight: bold; color: #333; margin-bottom: 10px; word-break: break-all; }
        .classification-form { margin-top: 10px; }
        .form-group { margin-bottom: 10px; }
        .form-group label { display: block; font-weight: bold; margin-bottom: 5px; color: #555; }
        .form-group select, .form-group input { width: 100%; padding: 5px; border: 1px solid #ddd; border-radius: 4px; }
        .status-indicator { position: absolute; top: 10px; right: 10px; padding: 5px 10px; border-radius: 4px; font-weight: bold; }
        .status-pending { background: #ffc107; color: #333; }
        .status-classified { background: #28a745; color: white; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); }
        .modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); max-width: 90%; max-height: 90%; }
        .modal-content img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .close-modal { position: absolute; top: 10px; right: 25px; color: white; font-size: 35px; font-weight: bold; cursor: pointer; }
        .progress-bar { background: #e9ecef; border-radius: 4px; height: 20px; margin: 10px 0; }
        .progress-fill { background: #28a745; height: 100%; border-radius: 4px; transition: width 0.3s; }
        .export-button { background: #17a2b8; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 10px 5px; }
        .export-button:hover { background: #138496; }
        .save-button { background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 10px 5px; }
        .save-button:hover { background: #218838; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîç BASS - Batch 5/5</h1>
        <p>Classify each image by animal type and process stage. Click images to enlarge.</p>
        
        <div class="progress-bar">
            <div id="progressFill" class="progress-fill" style="width: 0%"></div>
        </div>
        <p id="progressText">0/2 images classified</p>
        
        <div style="margin: 10px 0;">
            <button onclick="saveClassifications()" class="save-button">üíæ Save Progress</button>
            <button onclick="exportClassifications()" class="export-button">üì§ Export Classifications</button>
            <span id="saveStatus" style="margin-left: 10px; color: #28a745;"></span>
        </div>
    </div>

    <div class="navigation">
        <a href="index.html" class="nav-button">‚Üê Back to Index</a>
        <a href="bass_batch_4.html" class="nav-button">‚Üê Previous Batch</a>
        
    </div>

    <div class="image-grid" id="imageGrid">
        
            <div class="image-card" data-index="0">
                <div class="image-container">
                    <img src="/media/projects\bass\images\process\bass_bass_140.jpeg" alt="bass_bass_140.jpeg" onclick="openModal(this.src)">
                    <div class="status-indicator status-pending" id="status-0">Pending</div>
                </div>
                <div class="image-info">
                    <div class="filename">bass_bass_140.jpeg</div>
                    <div style="font-size: 0.9em; color: #666; margin-bottom: 10px;">projects\bass\images\process\bass_bass_140.jpeg</div>
                    
                    <div class="classification-form">
                        <div class="form-group">
                            <label for="animal-0">Animal Type:</label>
                            <select id="animal-0" onchange="handleAnimalSelection(0)">
                                <option value="">-- Select Animal --</option>
                                <optgroup label="Fish">
                                    <option value="largemouth_bass">Largemouth Bass</option>
                                    <option value="smallmouth_bass">Smallmouth Bass</option>
                                    <option value="striped_bass">Striped Bass</option>
                                    <option value="bass_generic">Bass (Generic)</option>
                                    <option value="trout">Trout</option>
                                    <option value="salmon">Salmon</option>
                                    <option value="pike">Pike</option>
                                    <option value="muskie">Muskie</option>
                                    <option value="walleye">Walleye</option>
                                    <option value="perch">Perch</option>
                                    <option value="catfish">Catfish</option>
                                    <option value="sunfish">Sunfish</option>
                                    <option value="other_fish">Other Fish</option>
                                </optgroup>
                                <optgroup label="Birds">
                                    <option value="bald_eagle">Bald Eagle</option>
                                    <option value="golden_eagle">Golden Eagle</option>
                                    <option value="eagle_generic">Eagle (Generic)</option>
                                    <option value="owl">Owl</option>
                                    <option value="hawk">Hawk</option>
                                    <option value="duck">Duck</option>
                                    <option value="goose">Goose</option>
                                    <option value="heron">Heron</option>
                                    <option value="cardinal">Cardinal</option>
                                    <option value="woodpecker">Woodpecker</option>
                                    <option value="other_bird">Other Bird</option>
                                </optgroup>
                                <optgroup label="Insects & Small Creatures">
                                    <option value="butterfly">Butterfly</option>
                                    <option value="dragonfly">Dragonfly</option>
                                    <option value="bee">Bee</option>
                                    <option value="spider">Spider</option>
                                    <option value="frog">Frog</option>
                                    <option value="turtle">Turtle</option>
                                    <option value="lizard">Lizard</option>
                                    <option value="snake">Snake</option>
                                </optgroup>
                                <optgroup label="Mammals">
                                    <option value="deer">Deer</option>
                                    <option value="bear">Bear</option>
                                    <option value="wolf">Wolf</option>
                                    <option value="fox">Fox</option>
                                    <option value="rabbit">Rabbit</option>
                                    <option value="squirrel">Squirrel</option>
                                    <option value="horse">Horse</option>
                                    <option value="cow">Cow</option>
                                    <option value="other_mammal">Other Mammal</option>
                                </optgroup>
                                <optgroup label="Marine Life">
                                    <option value="dolphin">Dolphin</option>
                                    <option value="whale">Whale</option>
                                    <option value="shark">Shark</option>
                                    <option value="octopus">Octopus</option>
                                </optgroup>
                                <optgroup label="Mythical/Religious">
                                    <option value="nessie">Nessie/Lake Monster</option>
                                    <option value="dragon">Dragon</option>
                                    <option value="st_collen">St. Collen</option>
                                    <option value="angel">Angel</option>
                                    <option value="cross">Cross</option>
                                </optgroup>
                                <optgroup label="Other">
                                    <option value="other_custom">Other (specify below)</option>
                                    <option value="unknown">Unknown/Unclear</option>
                                    <option value="not_animal">Not an Animal</option>
                                    <option value="multiple">Multiple Animals</option>
                                </optgroup>
                            </select>
                        </div>
                        
                        <div class="form-group" id="custom-animal-group-0" style="display: none;">
                            <label for="custom-animal-0">Custom Animal Type:</label>
                            <input type="text" id="custom-animal-0" placeholder="Enter animal type..." onchange="updateClassification(0)">
                        </div>
                        
                        <div class="form-group">
                            <label for="stage-0">Process Stage:</label>
                            <select id="stage-0" onchange="updateClassification(0)">
                                <option value="">-- Select Stage --</option>
                                <option value="raw_log">Raw Log (with bark)</option>
                                <option value="rough_carving">Rough Carving (basic shape)</option>
                                <option value="detailed_work">Detailed Work (features defined)</option>
                                <option value="finishing">Finishing (sanding, refinement)</option>
                                <option value="final_complete">Final Complete (painted/stained)</option>
                                <option value="unknown_stage">Unknown Stage</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="notes-0">Notes (optional):</label>
                            <input type="text" id="notes-0" placeholder="Any additional notes..." onchange="updateClassification(0)">
                        </div>
                    </div>
                </div>
            </div>
        
            <div class="image-card" data-index="1">
                <div class="image-container">
                    <img src="/media/projects\bass\images\process\bass_bass_141.jpeg" alt="bass_bass_141.jpeg" onclick="openModal(this.src)">
                    <div class="status-indicator status-pending" id="status-1">Pending</div>
                </div>
                <div class="image-info">
                    <div class="filename">bass_bass_141.jpeg</div>
                    <div style="font-size: 0.9em; color: #666; margin-bottom: 10px;">projects\bass\images\process\bass_bass_141.jpeg</div>
                    
                    <div class="classification-form">
                        <div class="form-group">
                            <label for="animal-1">Animal Type:</label>
                            <select id="animal-1" onchange="handleAnimalSelection(1)">
                                <option value="">-- Select Animal --</option>
                                <optgroup label="Fish">
                                    <option value="largemouth_bass">Largemouth Bass</option>
                                    <option value="smallmouth_bass">Smallmouth Bass</option>
                                    <option value="striped_bass">Striped Bass</option>
                                    <option value="bass_generic">Bass (Generic)</option>
                                    <option value="trout">Trout</option>
                                    <option value="salmon">Salmon</option>
                                    <option value="pike">Pike</option>
                                    <option value="muskie">Muskie</option>
                                    <option value="walleye">Walleye</option>
                                    <option value="perch">Perch</option>
                                    <option value="catfish">Catfish</option>
                                    <option value="sunfish">Sunfish</option>
                                    <option value="other_fish">Other Fish</option>
                                </optgroup>
                                <optgroup label="Birds">
                                    <option value="bald_eagle">Bald Eagle</option>
                                    <option value="golden_eagle">Golden Eagle</option>
                                    <option value="eagle_generic">Eagle (Generic)</option>
                                    <option value="owl">Owl</option>
                                    <option value="hawk">Hawk</option>
                                    <option value="duck">Duck</option>
                                    <option value="goose">Goose</option>
                                    <option value="heron">Heron</option>
                                    <option value="cardinal">Cardinal</option>
                                    <option value="woodpecker">Woodpecker</option>
                                    <option value="other_bird">Other Bird</option>
                                </optgroup>
                                <optgroup label="Insects & Small Creatures">
                                    <option value="butterfly">Butterfly</option>
                                    <option value="dragonfly">Dragonfly</option>
                                    <option value="bee">Bee</option>
                                    <option value="spider">Spider</option>
                                    <option value="frog">Frog</option>
                                    <option value="turtle">Turtle</option>
                                    <option value="lizard">Lizard</option>
                                    <option value="snake">Snake</option>
                                </optgroup>
                                <optgroup label="Mammals">
                                    <option value="deer">Deer</option>
                                    <option value="bear">Bear</option>
                                    <option value="wolf">Wolf</option>
                                    <option value="fox">Fox</option>
                                    <option value="rabbit">Rabbit</option>
                                    <option value="squirrel">Squirrel</option>
                                    <option value="horse">Horse</option>
                                    <option value="cow">Cow</option>
                                    <option value="other_mammal">Other Mammal</option>
                                </optgroup>
                                <optgroup label="Marine Life">
                                    <option value="dolphin">Dolphin</option>
                                    <option value="whale">Whale</option>
                                    <option value="shark">Shark</option>
                                    <option value="octopus">Octopus</option>
                                </optgroup>
                                <optgroup label="Mythical/Religious">
                                    <option value="nessie">Nessie/Lake Monster</option>
                                    <option value="dragon">Dragon</option>
                                    <option value="st_collen">St. Collen</option>
                                    <option value="angel">Angel</option>
                                    <option value="cross">Cross</option>
                                </optgroup>
                                <optgroup label="Other">
                                    <option value="other_custom">Other (specify below)</option>
                                    <option value="unknown">Unknown/Unclear</option>
                                    <option value="not_animal">Not an Animal</option>
                                    <option value="multiple">Multiple Animals</option>
                                </optgroup>
                            </select>
                        </div>
                        
                        <div class="form-group" id="custom-animal-group-1" style="display: none;">
                            <label for="custom-animal-1">Custom Animal Type:</label>
                            <input type="text" id="custom-animal-1" placeholder="Enter animal type..." onchange="updateClassification(1)">
                        </div>
                        
                        <div class="form-group">
                            <label for="stage-1">Process Stage:</label>
                            <select id="stage-1" onchange="updateClassification(1)">
                                <option value="">-- Select Stage --</option>
                                <option value="raw_log">Raw Log (with bark)</option>
                                <option value="rough_carving">Rough Carving (basic shape)</option>
                                <option value="detailed_work">Detailed Work (features defined)</option>
                                <option value="finishing">Finishing (sanding, refinement)</option>
                                <option value="final_complete">Final Complete (painted/stained)</option>
                                <option value="unknown_stage">Unknown Stage</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="notes-1">Notes (optional):</label>
                            <input type="text" id="notes-1" placeholder="Any additional notes..." onchange="updateClassification(1)">
                        </div>
                    </div>
                </div>
            </div>
        
    </div>

    <!-- Image Modal -->
    <div id="imageModal" class="modal" onclick="closeModal()">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <div class="modal-content">
            <img id="modalImage" src="" alt="">
        </div>
    </div>

    <script>
        // Store classifications
        window.animalClassifications = window.animalClassifications || {};
        const batchId = 'bass_batch_5';
        
        if (!window.animalClassifications[batchId]) {
            window.animalClassifications[batchId] = {};
        }

        // Load saved classifications
        const savedData = localStorage.getItem('animalClassifications_' + batchId);
        if (savedData) {
            try {
                const saved = JSON.parse(savedData);
                window.animalClassifications[batchId] = saved;
                loadSavedClassifications();
            } catch (e) {
                console.warn('Could not load saved classifications:', e);
            }
        }

        function handleAnimalSelection(index) {
            const animalSelect = document.getElementById('animal-' + index);
            const customGroup = document.getElementById('custom-animal-group-' + index);
            
            if (animalSelect.value === 'other_custom') {
                customGroup.style.display = 'block';
            } else {
                customGroup.style.display = 'none';
                document.getElementById('custom-animal-' + index).value = '';
            }
            
            updateClassification(index);
        }

        function updateClassification(index) {
            const animalSelect = document.getElementById('animal-' + index);
            const customAnimal = document.getElementById('custom-animal-' + index);
            const stage = document.getElementById('stage-' + index).value;
            const notes = document.getElementById('notes-' + index).value;
            
            // Determine the actual animal value
            let animal = animalSelect.value;
            if (animal === 'other_custom' && customAnimal.value.trim()) {
                animal = 'custom:' + customAnimal.value.trim();
            }
            
            const imageCard = document.querySelector('[data-index="' + index + '"]');
            const filename = imageCard.querySelector('.filename').textContent;
            const relativePath = imageCard.querySelector('.image-info > div:nth-child(2)').textContent;
            
            window.animalClassifications[batchId][index] = {
                filename: filename,
                relativePath: relativePath,
                animal: animal,
                stage: stage,
                notes: notes,
                timestamp: new Date().toISOString()
            };
            
            // Update status indicator
            const statusEl = document.getElementById('status-' + index);
            if (animal && stage) {
                statusEl.textContent = 'Classified';
                statusEl.className = 'status-indicator status-classified';
            } else {
                statusEl.textContent = 'Pending';
                statusEl.className = 'status-indicator status-pending';
            }
            
            updateProgress();
            autoSave();
        }

        function updateProgress() {
            const total = 2;
            const classified = Object.values(window.animalClassifications[batchId] || {})
                .filter(c => c.animal && c.stage).length;
            
            const percentage = (classified / total) * 100;
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = classified + '/' + total + ' images classified';
        }

        function autoSave() {
            saveClassifications();
            showSaveStatus('Auto-saved');
        }

        function saveClassifications() {
            try {
                localStorage.setItem('animalClassifications_' + batchId, 
                    JSON.stringify(window.animalClassifications[batchId]));
                showSaveStatus('Saved successfully');
                return true;
            } catch (e) {
                console.error('Save failed:', e);
                showSaveStatus('Save failed', true);
                return false;
            }
        }

        function showSaveStatus(message, isError = false) {
            const statusEl = document.getElementById('saveStatus');
            statusEl.textContent = message;
            statusEl.style.color = isError ? '#dc3545' : '#28a745';
            
            setTimeout(() => {
                statusEl.textContent = '';
            }, 3000);
        }

        function loadSavedClassifications() {
            const classifications = window.animalClassifications[batchId] || {};
            
            for (const [index, data] of Object.entries(classifications)) {
                if (data.animal) {
                    if (data.animal.startsWith('custom:')) {
                        // Handle custom animal type
                        document.getElementById('animal-' + index).value = 'other_custom';
                        document.getElementById('custom-animal-group-' + index).style.display = 'block';
                        document.getElementById('custom-animal-' + index).value = data.animal.substring(7);
                    } else {
                        document.getElementById('animal-' + index).value = data.animal;
                    }
                }
                if (data.stage) document.getElementById('stage-' + index).value = data.stage;
                if (data.notes) document.getElementById('notes-' + index).value = data.notes;
                
                const statusEl = document.getElementById('status-' + index);
                if (data.animal && data.stage) {
                    statusEl.textContent = 'Classified';
                    statusEl.className = 'status-indicator status-classified';
                }
            }
            
            updateProgress();
        }

        function exportClassifications() {
            const data = {
                batchId: batchId,
                project: 'bass',
                batchNumber: 5,
                classifications: window.animalClassifications[batchId] || {},
                exportTimestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = batchId + '_classifications.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function openModal(src) {
            document.getElementById('modalImage').src = src;
            document.getElementById('imageModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('imageModal').style.display = 'none';
        }

        // Initialize
        updateProgress();
        
        // Set up periodic auto-save every 30 seconds
        setInterval(autoSave, 30000);
        
        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                saveClassifications();
                showSaveStatus('Manual save complete');
            }
            if (e.ctrlKey && e.key === 'e') {
                e.preventDefault();
                exportClassifications();
            }
        });
        
        // Show initial save status
        showSaveStatus('Data loaded from browser storage');
    </script>
</body>
</html>